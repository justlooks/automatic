# Kickstart file automatically generated by anaconda.

#version=DEVEL
install
url --url=ftp://192.168.10.207/centos6_5
# use third-party yum repo(used for salt)
repo --name=local --baseurl=ftp://192.168.10.207/centos6_5
lang en_US.UTF-8
keyboard us
text
skipx
%include /tmp/network.ks

#network --onboot yes --device eth0 --bootproto static --ip 192.168.10.247 --netmask 255.255.255.0 --gateway 192.168.10.1 --noipv6 --nameserver 8.8.8.8 
rootpw  --iscrypted $6$v3Q3zHDnZNPkmPym$ejwqBj7tIzHFWYGkbXdS74pwX1hb.iBApvFB9kwBMBiWQPa2O7rxTxnMbu6x6SaDqEZKagGc2jzgtEDfd9XNt/

firewall --disabled
authconfig --enableshadow --passalgo=sha512
selinux --disabled
timezone --utc Asia/Shanghai
bootloader --location=mbr --driveorder=sda
zerombr
clearpart --all --initlabel
part /  --fstype=ext4 --grow --size=1
part /boot --fstype=ext4 --size=200
part swap --size=1024



%packages --nobase
@core
wget
openssh-clients
%end
%pre
#!/bin/sh
BASE="network --onboot yes --bootproto static --noipv6"
for x in `cat /proc/cmdline`;do
        case $x in
                HOSTNAME*)
                        eval $x;;
                HOSTIP*)
                        eval $x;;
                HOSTGW*)
                        eval $x;;
                HOSTDNS*)
                        eval $x;;
                NETMASK*)
                        eval $x;;
        esac;
done
BASE="$BASE --hostname ${HOSTNAME-"needbeset"} --ip ${HOSTIP-"192.168.10.230"} --nameserver ${HOSTDNS-"8.8.4.4"} --gateway ${HOSTGW-"192.168.10.1"} --netmask ${NETMASK-"255.255.255.0"}"
echo "$BASE" > /tmp/network.ks
%end

%post --log=/tmp/post.log
sed -i 's/^timeout=.*$/timeout=1/' /boot/grub/grub.conf
#sed -i 's/^#master: .*$/ master: 192.168.10.124/' /etc/salt/minion
#sed -i "s/^#id:/ id: $(hostname)/" /etc/salt/minion
wget -q -O- ftp://192.168.10.207/yum.repod/centos65.repo > /etc/yum.repos.d/localos.repo
%end

reboot
